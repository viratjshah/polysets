"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),s=require("axios"),t=require("primereact/inputtext"),a=require("primereact/checkbox"),r=require("primereact/button");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=o(e),d=o(s);class l extends e.Component{constructor(e){super(e),this.state={username:"",password:"",repassword:"",chkreme:!1,loading:!1,validPassword:!1,validUsername:!1},this.pattern={lowerCase:/[a-z]/g,upperCase:/[A-Z]/g,number:/[0-9]/g,specialChar:/[ `!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/g,email:/^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/},this.Constants=this.props?.constants,this.nextPage=this.props?.nextpage}authorize(){let e=this.state.username,s=this.state.password,t="";if("signup"===this.props.mode){if(!this.state.validPassword||!this.state.validUsername||this.state.password!==this.state.repassword)return void this.props.showError({error:!0,errorMessage:"Please re-check email address and password"});t=this.Constants.BASE_URL+this.Constants.REGISTER,console.log({username:e,password:s}),d.default.post(t,{username:e,password:s}).then((e=>{console.log(e.data),e.data.success||this.props.showError({error:!0,errorMessage:e.data.msg?e.data.msg:"Signup failed"}),this.setState({success:e.data.success,loading:!1}),window.location="/login"})).catch((e=>{this.props.showError({error:!0,errorMessage:"Signup failed"}),console.log(e),this.setState({loading:!1})}))}else if("login"===this.props.mode){if(!this.state.validPassword||!this.state.validUsername)return void this.props.showError({error:!0,errorMessage:"Please re-check email address and password"});console.log("login"),t=this.Constants.BASE_URL+this.Constants.LOGIN,d.default.post(t,{username:e,password:s}).then((e=>{console.log(e.data),e.data.success?e.data.success&&e.data.token?(window.sessionStorage.setItem("access-token",e.data.token),this.setState({success:e.data.success,loading:!1}),window.location="/login"):(this.props.showError({error:!0,errorMessage:"Could not complete request"}),this.setState({loading:!1})):(this.props.showError({error:!0,errorMessage:e.data.msg?e.data.msg:"Login failed"}),this.setState({loading:!1}))})).catch((e=>{console.log(e),this.props.showError({error:!0,errorMessage:"Login failed"}),this.setState({loading:!1})}))}else if("resetpwd"===this.props.mode){if(!this.state.validUsername)return void this.props.showError({error:!0,errorMessage:"Please re-check email address"});t=this.Constants.BASE_URL+this.Constants.RESET,console.log({username:e}),d.default.post(t,{username:e}).then((e=>{console.log(e.data),e.data.success||this.props.showError({error:!0,errorMessage:e.data.msg?e.data.msg:"Request failed"}),this.setState({success:e.data.success,loading:!1})})).catch((e=>{console.log(e),this.props.showError({error:!0,errorMessage:res.data.msg?res.data.msg:"Request failed"}),this.setState({loading:!1})}))}}usernameHandler(e){e.match(this.pattern.email)?(this.props.showError({error:!1,errorMessage:""}),this.setState({validUsername:!0,username:e})):(this.props.showError({error:!0,errorMessage:"Please enter a valid email address."}),this.setState({validUsername:!1,username:e}))}passwordHandler(e){e.match(this.pattern.lowerCase)&&e.match(this.pattern.upperCase)&&e.match(this.pattern.specialChar)&&e.match(this.pattern.number)&&e.length>=8?(this.props.showError({error:!1,errorMessage:""}),"signup"===this.props.mode?this.setState({password:e}):this.setState({validPassword:!0,password:e})):(this.props.showError({error:!0,errorMessage:"Password should contain at least one: Uppercase character, lowercase character, special character a number and must be atleast 8 characters long"}),this.setState({validPassword:!1,password:e}))}repasswordHandler(e){e===this.state.password?(this.props.showError({error:!1,errorMessage:""}),this.setState({repassword:e,validPassword:!0})):(this.props.showError({error:!0,errorMessage:"Passwords do not match"}),this.setState({validPassword:!1,repassword:e}))}render(){const e=this.props.mode;return i.default.createElement("div",{className:"p-field p-col-6 p-md-6 p-mt-5 authpght"},i.default.createElement("div",{className:"card"},i.default.createElement("div",{className:"p-grid p-mt-2 p-m-0"},i.default.createElement("div",{className:"p-col"},i.default.createElement("div",{className:"box"},i.default.createElement(t.InputText,{id:"emailaddress",value:this.state.username,onChange:e=>this.usernameHandler(e.target.value),placeholder:"Email address",type:"text"})))),"resetpwd"!==e&&i.default.createElement("div",{className:"p-grid p-mt-2 p-m-0"},i.default.createElement("div",{className:"p-col"},i.default.createElement("div",{className:"box"},i.default.createElement(t.InputText,{id:"password",value:this.state.password,onChange:e=>this.passwordHandler(e.target.value),placeholder:"Password",type:"password"})))),"signup"===e&&i.default.createElement("div",{className:"p-grid p-mt-2 p-m-0"},i.default.createElement("div",{className:"p-col"},i.default.createElement("div",{className:"box"},i.default.createElement(t.InputText,{id:"repassword",value:this.state.repassword,onChange:e=>this.repasswordHandler(e.target.value),placeholder:"Re-enter Password",type:"password"})))),"login"===e&&i.default.createElement("div",{className:"loginchk"},i.default.createElement(a.Checkbox,{inputId:"chkreme",onChange:()=>this.setState({chkreme:!this.state.chkreme}),checked:this.state.chkreme}),i.default.createElement("label",{htmlFor:"chkreme",className:"p-ml-2"},"Remember Me")),i.default.createElement(r.Button,{disabled:this.state.loading,loading:this.state.loading,loadingOptions:{position:"right"},label:"login"===e?"Login":"signup"===e?"Sign Up":"resetpwd"===e?"Reset Password":'Assign mode as "login", "signup" or "resetpwd"',onClick:()=>this.authorize(),className:"p-button-info p-mt-2"}),"login"===e&&i.default.createElement("small",{className:"loginfgtpwd"},i.default.createElement("a",{href:"/resetpwd"}," Forgot Password?"))))}}exports.AuthnForm=l;
