import e,{Component as s}from"react";import t from"axios";import{InputText as a}from"primereact/inputtext";import{Checkbox as r}from"primereact/checkbox";import{Button as o}from"primereact/button";class i extends s{constructor(e){super(e),this.state={username:"",password:"",repassword:"",chkreme:!1,loading:!1},this.Constants=this.props?.constants,this.nextPage=this.props?.nextpage}authorize(){let e=this.state.username,s=this.state.password,a="";"signup"===this.props.mode?(a=this.Constants.BASE_URL+this.Constants.REGISTER,console.log({username:e,password:s}),t.post(a,{username:e,password:s}).then((e=>{console.log(e.data),e.data.success||this.props.showError({error:!0,errorMessage:e.data.msg?e.data.msg:"Signup failed"}),this.setState({success:e.data.success,loading:!1}),window.location=this.nextPage||"/"})).catch((e=>{this.props.showError({error:!0,errorMessage:"Signup failed"}),console.log(e),this.setState({loading:!1})}))):"login"===this.props.mode?(console.log("login"),a=this.Constants.BASE_URL+this.Constants.LOGIN,console.log({username:e,password:s}),t.post(a,{username:e,password:s}).then((e=>{console.log(e.data),e.data.success||this.props.showError({error:!0,errorMessage:e.data.msg?e.data.msg:"Login failed"}),this.setState({success:e.data.success,loading:!1}),window.location=this.nextPage||"/"})).catch((e=>{console.log(e),this.props.showError({error:!0,errorMessage:"Login failed"}),this.setState({loading:!1})}))):"resetpwd"===this.props.mode&&(a=this.Constants.BASE_URL+this.Constants.RESET,console.log({username:e}),t.post(a,{username:e}).then((e=>{console.log(e.data),e.data.success||this.props.showError({error:!0,errorMessage:e.data.msg?e.data.msg:"Request failed"}),this.setState({success:e.data.success,loading:!1}),window.location=this.nextPage||"/"})).catch((e=>{console.log(e),this.props.showError({error:!0,errorMessage:res.data.msg?res.data.msg:"Request failed"}),this.setState({loading:!1})})))}validation(){this.setState({loading:!0});validPassword=!1,validUsername=!1;let e=this.state.username,s=this.state.password;"resetpwd"===this.props.mode?validPassword=!0:s.match(/[a-z]/g)&&s.match(/[A-Z]/g)&&s.match(/[0-9]/g)&&s.match(/[ `!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/g)&&s.length>=8&&("signup"===this.props.mode?s===this.state.repassword?validPassword=!0:(this.props.showError({error:!0,errorMessage:"Passwords do not match"}),this.setState({loading:!1})):validPassword=!0),!e.trim().includes(" ")&&e.match(/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/)&&(validUsername=!0),validUsername&&validPassword?(this.props.showError({error:!1,errorMessage:""}),this.authorize()):validUsername||validPassword?validUsername?validPassword||(this.props.showError({error:!0,errorMessage:"Invalid Password."}),this.setState({loading:!1})):(this.props.showError({error:!0,errorMessage:"Invalid Username"}),this.setState({loading:!1})):(this.props.showError({error:!0,errorMessage:"Invalid Username and password"}),this.setState({loading:!1}))}render(){const s=this.props.mode;return e.createElement("div",{className:"p-field p-col-6 p-md-6 p-mt-5 authpght"},e.createElement("div",{className:"card"},e.createElement("div",{className:"p-grid p-mt-2 p-m-0"},e.createElement("div",{className:"p-col"},e.createElement("div",{className:"box"},e.createElement(a,{id:"emailaddress",value:this.state.username,onChange:e=>this.setState({username:e.target.value}),placeholder:"Email address",type:"text"})))),"resetpwd"!==s&&e.createElement("div",{className:"p-grid p-mt-2 p-m-0"},e.createElement("div",{className:"p-col"},e.createElement("div",{className:"box"},e.createElement(a,{id:"password",value:this.state.password,onChange:e=>this.setState({password:e.target.value}),placeholder:"Password",type:"password"})))),"signup"===s&&e.createElement("div",{className:"p-grid p-mt-2 p-m-0"},e.createElement("div",{className:"p-col"},e.createElement("div",{className:"box"},e.createElement(a,{id:"repassword",value:this.state.repassword,onChange:e=>this.setState({repassword:e.target.value}),placeholder:"Re-enter Password",type:"password"})))),"login"===s&&e.createElement("div",{className:"loginchk"},e.createElement(r,{inputId:"chkreme",onChange:()=>this.setState({chkreme:!this.state.chkreme}),checked:this.state.chkreme}),e.createElement("label",{htmlFor:"chkreme",className:"p-ml-2"},"Remember Me")),e.createElement(o,{loading:this.state.loading,loadingOptions:{position:"right"},label:"login"===s?"Login":"signup"===s?"Sign Up":"resetpwd"===s?"Reset Password":'Assign mode as "login", "signup" or "resetpwd"',onClick:()=>this.validation(),className:"p-button-info p-mt-2"}),"login"===s&&e.createElement("small",{className:"loginfgtpwd"},e.createElement("a",{href:"/resetpwd"}," Forgot Password?"))))}}export{i as AuthnForm};
